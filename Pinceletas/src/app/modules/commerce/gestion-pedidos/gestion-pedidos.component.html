<div class="container mt-4">
  <!-- Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1 class="mb-1">
            <i class="fas fa-tasks text-primary me-2"></i>
            Gestión de Pedidos
          </h1>
          <p class="text-muted mb-0">Administra todos los pedidos del sistema</p>
        </div>
      </div>
      <button class="btn btn-outline-primary me-2" (click)="cargarPedidos()" [disabled]="cargando">
        <i class="fas fa-sync-alt me-2" [class.fa-spin]="cargando"></i>
        Actualizar
      </button>
    </div>
  </div>

  <!-- Filtros -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <div class="row align-items-end">
            <!-- Filtro por número de pedido -->
            <div class="col-md-4 mb-2">
              <label class="form-label fw-bold text-secondary">Número de Pedido:</label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="filtroNumeroPedido"
                (input)="aplicarFiltros()"
                placeholder="Buscar por número..."
              />
            </div>

            <!-- Filtro por fecha inicio -->
            <div class="col-md-3 mb-2">
              <label class="form-label fw-bold text-secondary">Fecha desde:</label>
              <input
                type="date"
                class="form-control"
                [(ngModel)]="filtroFechaInicio"
                (change)="aplicarFiltros()"
              />
            </div>

            <!-- Filtro por fecha fin -->
            <div class="col-md-3 mb-2">
              <label class="form-label fw-bold text-secondary">Fecha hasta:</label>
              <input
                type="date"
                class="form-control"
                [(ngModel)]="filtroFechaFin"
                (change)="aplicarFiltros()"
              />
            </div>

            <!-- Botón limpiar -->
            <div class="col-md-2 mb-2">
              <button class="btn btn-outline-secondary w-100" (click)="limpiarFiltros()">
                <i class="fas fa-trash me-1"></i> Limpiar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="cargando" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="text-muted mt-2">Cargando pedidos...</p>
  </div>

  <!-- Lista de pedidos -->
  <div *ngIf="!cargando">
    <!-- Contador -->
    <div class="row mb-3">
      <div class="col-12">
        <div class="alert alert-info py-2">
          <i class="fas fa-info-circle me-2"></i>
          Mostrando <strong>{{ pedidosFiltrados.length }}</strong> de <strong>{{ pedidos.length }}</strong> pedidos
        </div>
      </div>
    </div>

    <!-- Tabla de pedidos -->
    <div class="card shadow-sm" *ngIf="pedidosFiltrados.length > 0">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th class="ps-4">Número</th>
                <th>Fecha</th>
                <th>Cliente</th>
                <th>Total</th>
                <th>Estado</th>
                <th class="text-center pe-4">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let pedido of pedidosFiltrados" class="align-middle">
                <td class="ps-4">
                  <strong>{{ pedido.numeroPedido }}</strong>
                </td>
                <td>
                  {{ formatearFecha(pedido.fechaCreacion) }}
                </td>
                <td>
                  {{ pedido.emailContacto }}
                </td>
                <td>
                  <span class="fw-bold text-success">{{ formatearMoneda(pedido.total) }}</span>
                </td>
                <td>
                  <span [class]="getBadgeClass(pedido.estado)" class="badge">
                    {{ pedido.estado }}
                  </span>
                </td>
                  <td class="text-center pe-4">
                      <div class="btn-group" role="group">
                        <button 
                          class="btn btn-outline-primary btn-sm me-2"
                          (click)="verDetallePedido(pedido.id)"
                          title="Ver detalle del pedido">
                          <i class="fas fa-eye"></i>
                        </button>
                        <!-- ✅ NUEVO: Botón para abrir modal -->
                        <button 
                          class="btn btn-outline-secondary btn-sm"
                          (click)="abrirModalEditarEstado(pedido)"
                          title="Editar estado">
                          <i class="fas fa-edit"></i>
                        </button>
                      </div>
                  </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Sin pedidos -->
    <div *ngIf="pedidosFiltrados.length === 0" class="text-center py-5">
      <div class="card border-0 shadow-sm">
        <div class="card-body py-5">
          <i class="fas fa-tasks fa-3x text-secondary mb-3"></i>
          <h4 class="text-secondary">No hay pedidos</h4>
          <p class="text-muted" *ngIf="filtroNumeroPedido || filtroFechaInicio || filtroFechaFin">
            No se encontraron pedidos con los filtros aplicados
          </p>
          <p class="text-muted" *ngIf="!filtroNumeroPedido && !filtroFechaInicio && !filtroFechaFin">
            No hay pedidos en el sistema
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
<app-editar-estado-pedido-modal
  *ngIf="mostrarModalEditarEstado"
  [pedido]="pedidoSeleccionado"
  (estadoActualizado)="actualizarEstadoDesdeModal($event)"
  (cerrarModal)="cerrarModal()">
</app-editar-estado-pedido-modal>