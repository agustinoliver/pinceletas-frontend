<!-- product-detail.component.html -->
<div class="container mt-4" *ngIf="producto">
  <div class="row">
    <div class="col-12 mb-3">
      <button class="btn btn-outline-secondary" (click)="volverALista()">
        <i class="fas fa-arrow-left me-2"></i>Volver a la lista
      </button>
    </div>
  </div>

  <div class="row">
    <!-- Galería de imágenes del producto -->
    <div class="col-md-6 mb-4">
      <!-- Carrusel de imágenes del producto -->
      <div class="image-container-detail position-relative" *ngIf="producto?.imagenes?.length">
        <div *ngIf="tieneDescuento()" class="position-absolute top-0 end-0 m-3">
          <span class="badge bg-danger p-2" style="font-size: 1rem;">
            <i class="fas fa-tag me-1"></i>{{ producto.descuentoPorcentaje }}% OFF
          </span>
        </div>

        <div id="carouselProducto" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner">
            <div *ngFor="let imagen of producto?.imagenes; let i = index"
                class="carousel-item"
                [class.active]="i === 0">
              <img
                [src]="getImagenUrl(imagen)"
                class="d-block w-100 rounded shadow main-image"
                alt="{{ producto.nombre }} - Imagen {{ i + 1 }}"
                (error)="handleImageError($event)" />
            </div>
          </div>

          <!-- Controles del carrusel -->
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselProducto" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Anterior</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselProducto" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Siguiente</span>
          </button>
        </div>
      </div>

      <!-- Placeholder cuando no hay imágenes -->
      <div class="image-placeholder-detail" *ngIf="!producto?.imagenes?.length">
        <i class="fas fa-image fa-3x"></i>
        <span>Imagen no disponible</span>
      </div>
    </div>

    <!-- Información del producto -->
    <div class="col-md-6">
      <div class="product-info">
        <h1 class="product-title mb-3">{{ producto.nombre }}</h1>
        <p class="product-description text-muted mb-4">{{ producto.descripcion }}</p>
        
        <!-- Sección de precios -->
        <div class="price-section mb-4 p-3 bg-light rounded">
          <div *ngIf="tieneDescuento()">
            <p class="text-muted text-decoration-line-through mb-2" style="font-size: 1.1rem;">
              Precio original: ${{ producto.precio }}
            </p>
            <h2 class="text-danger mb-2">
              <strong>${{ calcularPrecio()?.precioFinal }}</strong>
            </h2>
            <p class="text-success mb-0">
              <i class="fas fa-check-circle me-2"></i>
              <strong>Ahorras: ${{ calcularPrecio()?.montoDescuento }}</strong>
            </p>
          </div>
          <div *ngIf="!tieneDescuento()">
            <h2 class="text-primary mb-0">
              <strong>${{ producto.precio }}</strong>
            </h2>
          </div>
        </div>

        <!-- Selector de opciones - SOLO si el producto tiene opciones -->
        <div class="options-section mb-4" *ngIf="producto.opciones && producto.opciones.length > 0">
          <label class="form-label fw-bold">Selecciona una opción:</label>
          <select 
            class="form-select" 
            [(ngModel)]="opcionSeleccionada"
            (change)="seleccionarOpcion($event)">
            <option [value]="null">Elige una opción</option>
            <option 
              *ngFor="let opcion of producto.opciones" 
              [value]="opcion.id">
              {{ opcion.tipo }}
            </option>
          </select>
          <small class="text-muted" *ngIf="!opcionSeleccionada">
            * Debes seleccionar una opción antes de agregar al carrito
          </small>
        </div>

        <!-- Botones de acción -->
        <div class="action-buttons">
          <button 
            class="btn btn-primary btn-lg me-3"
            (click)="agregarAlCarrito()"
            [disabled]="producto.opciones.length > 0 && !opcionSeleccionada">
            <i class="fas fa-shopping-cart me-2"></i>
            Agregar al Carrito
          </button>
          <button 
            class="btn btn-outline-danger btn-lg"
            (click)="toggleFavorito()"
            [class.btn-danger]="esFavorito"
            [class.btn-outline-danger]="!esFavorito">
            <i class="fas fa-heart me-2"></i>
            {{ esFavorito ? 'En Favoritos' : 'Agregar a Favoritos' }}
          </button>
        </div>

        <!-- Información adicional -->
        <div class="product-meta mt-4 pt-4 border-top">
          <div class="row">
            <div class="col-6">
              <small class="text-muted">Estado:</small>
              <br>
              <strong [class]="producto.activo ? 'text-success' : 'text-danger'">
                {{ producto.activo ? 'Disponible' : 'No disponible' }}
              </strong>
            </div>
            <div class="col-6" *ngIf="producto.imagenes && producto.imagenes.length > 1">
              <small class="text-muted">Imágenes:</small>
              <br>
              <strong class="text-info">
                {{ producto.imagenes.length }} disponibles
              </strong>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading state -->
<div class="container mt-4" *ngIf="!producto">
  <div class="row">
    <div class="col-12 text-center">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-2">Cargando producto...</p>
    </div>
  </div>
</div>